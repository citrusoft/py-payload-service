# Payload Estimator Service
This repository contains the code for the Payload Estimator Service, which is designed to estimate the expected payload of passenger count, baggage weight and cargo weight for a given flight(aka route), origin(airport code), destination(airport code) and day of the year(julian date).

The service is built using FastAPI and is automatically generated by the OpenAPI Generator.
The service is intended to be used as a microservice within a larger application, and is not intended to be run as a standalone application.
The service is packaged for pip and imaged with Docker.
The service is currently in development and is not yet ready for production use.
The service is unlicensed and is provided "as is" without warranty of any kind.
The service is developed and maintained by the Payload Estimator Service team at [Citrusoft](https://www.citrusoft.org/).
The service is open source and contributions are welcome. Please see the CONTRIBUTING.md file for more information.
The service is documented using OpenAPI and the documentation is available at `http://localhost:8080/docs/` when the service is running.
The service is tested using pytest and the tests are located in the `tests` directory.
The service is continuously integrated and deployed using GitHub Actions.
The service is monitored using Prometheus and Grafana.
The service is configured using environment variables. Please see the `.env.example` file for more information
The service is designed to be scalable and can be deployed using Kubernetes or other container orchestration tools.

The data is sourced from the US Department of Transportation's Bureau of Transportation Statistics (BTS) and the Federal Aviation Administration (FAA). The data is processed and stored in a PostgreSQL database.

## Quickstart
# start a local Postgres container
docker run --name payloads-db -e POSTGRES_PASSWORD=postgres -p 5432:5432 -d postgres:15

# create the DB
docker exec -it payloads-db psql -U postgres -c "CREATE DATABASE payloads_db;"

# apply schema
docker cp sql/schema.sql payloads-db:/schema.sql
docker exec -it payloads-db psql -U postgres -d payloads_db -f /schema.sql

# install deps
pip3 install -r requirements.txt

# run OpenAPI server with local DB (adjust host/creds if needed)
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/payloads_db PYTHONPATH=src uvicorn openapi_server.main:app --host 0.0.0.0 --port 8080 --reload


## Testing

### Unit tests
PYTHONPATH=src pytest -v

### Smoke TestClient
PYTHONPATH=src python3 - <<'PY'
from fastapi.testclient import TestClient
from openapi_server.main import app
client = TestClient(app)
print(client.get('/payloads').status_code)
print(client.get('/payloads').json())
PY

## Documentation
The OpenAPI docs are available at `http://localhost:8080/docs/` when the service is running.

## See also
